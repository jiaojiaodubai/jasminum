urls = [
  "https://kns.cnki.net/kcms2/article/abstract?v=WStw-PbchoxXklMd97G3EDrMY35-fvcPWOGNHjK8hkbbqADLh5NGc0AmBzjI4D8ZwjzI0VHODsFQlS8sdwe2eU_tJN9s3hzTpF8GC2jjom6r22HYP5NTbScHRtT5YFMOmmBgOTPkcgh2Bsw--3eXUh2HpUIUCy4q97DM744ETBHcmNUo8g9ZvnNyVq_LgaRN&uniplatform=NZKPT&language=CHS",
  "https://kns.cnki.net/kcms2/article/abstract?v=WStw-PbchowBkjKe5MjlmHuD-RasNVJ8dt-b6UD3KtSDnt1n7QxJkch8TZaKbJ8-7MQj0xUrYGr09gE16oyAIvXEr-CiiCdkjjgSqFVq36YzC43jvtJ2f8hTOpY1PGy1XXfcCGLSIRM1wzVCGndk4adUcZQZlQHK2d03J4NCfegvuPcn9U-_NhqwCcaqf5w6&uniplatform=NZKPT&language=CHS",
  "https://kns.cnki.net/kcms2/article/abstract?v=WStw-Pbchowjmw6mw3uKbpWLZ2thd4Ikj9aGW2c6LgczKWCuX2sbJIEMj6bB-0Myb9sYR96tSlb8Gk0R2Z5YBIcrMYuwuydhjwJOEbFIivRXFXmcPpCYR-7eh9QpC0Giq2tNOlOdx3rz-Z-fSV0yg_0xomFu3lvR2KqJ3Zf28JSRHc4XLMIunw9eaiJQVXkZ&uniplatform=NZKPT&language=CHS",
  "https://kns.cnki.net/kcms2/article/abstract?v=WStw-Pbchozhh8Fgt64WtzqgcMwtTHrBrYlh7Q4yySg7hnJ_gZrfncEA9PcKga4FKUf8K3eYz08N-kJkGU6a490pkki0kvUVkunG1MGAhnigUdsqHsG2wsWHE_qELcwKOaJxO6eY8DTnp1B33RIvWXn7MIYquE-yHHXjmoQOk2vu5RZvFrEQBYLhzKS-EGmA&uniplatform=NZKPT&language=CHS",
  "https://kns.cnki.net/kcms2/article/abstract?v=WStw-Pbchoza91b55tjwPPpLVRsheZOKpFgcAdm6LDyIObh40SwtF5bPj3e9eAkU_c4S8MDmOIWVqRv5OJ6eq-KGt0sSbL9666NHWAvybhtwrlr-ULB8eGMFZS_h01YjBrmxfsdYY0cXK4SYnSghWoce8plJZitosysJn497tMNlbBu19zoyZ5-G5ms_xGKc&uniplatform=NZKPT&language=CHS",
  "https://kns.cnki.net/kcms2/article/abstract?v=WStw-Pbchozs-rV1BnuxrpzoDrIrhHINoJIdxyeKIPB5uWktgKly2H6ZJQQUSjRUVoPUCHXoyZLBT2eDcH5MrDol9zfNqvscmrbJfOFiKe2bkCEET1Voc00whH0Bu4xrNDK0j5RUMqKj2JH-EELIoBDNoj1nmj6lcvxK69GmV48jw6V6GBOlfa5grOY_WfBB&uniplatform=NZKPT&language=CHS",
  "https://kns.cnki.net/kcms2/article/abstract?v=WStw-PbchozAYll_0WbZyNsWw69XWM7MujYLUcTpPk_wHBzcDHl6z8xIFKgbBP9GUZ9aGf3xAFtR4ludtNumAxX85oiU2rxkqQcMorrBsa9mvJm0YqwmGSbDSJixg-Sfl3jFOFbqE9hxs1wOIhddFbgjxBRi6P-nt1qdcyak53AgrKhuQ7zmthllMkRJhI4G&uniplatform=NZKPT&language=CHS",
  "https://kns.cnki.net/kcms2/article/abstract?v=WStw-PbchoxEbdsGcNHq4lrTk8lk2vE82akoFjaBTi997kL-xCmHHFG8ddNmO7SYE8ibGqs4um70WtUldjIAcPyXe_UQ9_FZ7CrfrL1LkRsBTlBS8dg1um9MAQ2PUKnlEYe7jGB4s2dVwVpuRiIYVChSfZwqfit-ESOlDTf3yUU1IGYJXEZjmjBuDiN1yYTE&uniplatform=NZKPT&language=CHS",
  "https://kns.cnki.net/kcms2/article/abstract?v=WStw-PbchozMxohk4EHQgPvZYZSpp2pf1Clf4BOwXKJW-wtnhxwYhRRBeURaHD2zPZ0ddjazGcg8BfOp4LAD4h9Cpn1ayUP2VlWH_6RkdOx6hI_uuWiYNJFz-yugVFEJvifSPBEHKkHRon3KEsfqvr-R83eYznYYIsa-pzPO4Jum2xGpudDoD5HuwW0UjJn6&uniplatform=NZKPT&language=CHS",
  "https://kns.cnki.net/kcms2/article/abstract?v=WStw-Pbchoy5-_CNHo0wZ1paiWwks_fDQzOTRX44Y6bF7RG-Fpwv4BP68IIvRyWLrA5ae8uTjpDS7CxdemHyUTxIOoha7kIy0vBR3XEZvBSztPhhfGdWk8RxOlqNUqh4v3n-eBRQq0c_YhcPyvuSjfz5Zga5iA4ijhKzLMwUrRsgc0Ad7kbLc0dtOpz9nz3V&uniplatform=NZKPT&language=CHS",
];

async function getDoc(url) {
  const xhr = await Zotero.HTTP.request("GET", url, {
    responseType: "document",
  });
  let doc = xhr.response;
  if (doc && !doc.location) {
    doc = Zotero.HTTP.wrapDocument(doc, xhr.responseURL);
  }
  return doc;
}

async function translate(doc) {
  const translate = new Zotero.Translate.Web();
  // CNKI
  translate.setTranslator("5c95b67b-41c5-4f55-b71a-48d5d7183063");
  translate.setDocument(doc);
  const items = await translate.translate({
    libraryID: false, // 不保存
    saveAttachments: false,
  });
  const item = items[0];
  return item;
}

function delay(ms) {
  return new Promise((resolve) => setTimeout(resolve, ms));
}

async function test(urls) {
  for (let i of [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]) {
    console.log("#####" + i);
    for (let url of urls) {
      await delay(3000);
      let d = await getDoc(url);
      let item = await translate(d);
      console.log(item.key, item.title, item.getField("publicationTitle"));
    }
  }
}
